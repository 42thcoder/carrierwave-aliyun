<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>carrierwave-aliyun by huacnlee</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">carrierwave-aliyun</h1>
      <h2 class="project-tagline">阿里云 OSS Ruby 上传组件，基于 Carrierwave</h2>
      <a href="https://github.com/huacnlee/carrierwave-aliyun" class="btn">View on GitHub</a>
      <a href="https://github.com/huacnlee/carrierwave-aliyun/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/huacnlee/carrierwave-aliyun/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="carrierwave-for-aliyun-oss" class="anchor" href="#carrierwave-for-aliyun-oss" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>CarrierWave for Aliyun OSS</h1>

<p>This gem adds support for <a href="http://oss.aliyun.com">Aliyun OSS</a> to <a href="https://github.com/jnicklas/carrierwave/">CarrierWave</a></p>

<p><a href="https://rubygems.org/gems/carrierwave-aliyun"><img src="https://badge.fury.io/rb/carrierwave-aliyun.svg" alt="Gem Version"></a> <a href="https://travis-ci.org/huacnlee/carrierwave-aliyun"><img src="https://travis-ci.org/huacnlee/carrierwave-aliyun.svg?branch=master" alt="Build Status"></a> <a href="https://codeclimate.com/github/huacnlee/carrierwave-aliyun"><img src="https://codeclimate.com/github/huacnlee/carrierwave-aliyun/badges/gpa.svg" alt="Code Climate"></a></p>

<blockquote>
<p>NOTE: 此 Gem 是一个 CarrierWave 的组件，你需要配合 CarrierWave 一起使用，如果你需要直接用 Aliyun OSS，可以尝试用 <a href="https://github.com/aliyun-beta/aliyun-oss-ruby-sdk">aliyun-oss-ruby-sdk</a> 这个 Gem。</p>
</blockquote>

<h2>
<a id="using-bundler" class="anchor" href="#using-bundler" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Using Bundler</h2>

<div class="highlight highlight-source-ruby"><pre><span class="pl-k">gem</span> <span class="pl-s"><span class="pl-pds">'</span>carrierwave-aliyun<span class="pl-pds">'</span></span></pre></div>

<h2>
<a id="configuration" class="anchor" href="#configuration" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Configuration</h2>

<p>创建这么个脚本 <code>config/initializers/carrierwave.rb</code> 填入下面的代码，并修改对应的配置：</p>

<div class="highlight highlight-source-ruby"><pre><span class="pl-c1">CarrierWave</span>.configure <span class="pl-k">do </span>|<span class="pl-smi">config</span>|
  config.storage           <span class="pl-k">=</span> <span class="pl-c1">:aliyun</span>
  config.aliyun_access_id  <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>xxxxxx<span class="pl-pds">"</span></span>
  config.aliyun_access_key <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>xxxxxx<span class="pl-pds">'</span></span>
  <span class="pl-c"># 你需要在 Aliyum OSS 上面提前创建一个 Bucket</span>
  config.aliyun_bucket     <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>simple<span class="pl-pds">"</span></span>
  <span class="pl-c"># 是否使用内部连接，true - 使用 Aliyun 主机内部局域网的方式访问  false - 外部网络访问</span>
  config.aliyun_internal   <span class="pl-k">=</span> <span class="pl-c1">true</span>
  <span class="pl-c"># 配置存储的地区数据中心，默认: cn-hangzhou</span>
  <span class="pl-c"># config.aliyun_area     = "cn-hangzhou"</span>
  <span class="pl-c"># 使用自定义域名，设定此项，carrierwave 返回的 URL 将会用自定义域名</span>
  <span class="pl-c"># 自定于域名请 CNAME 到 you_bucket_name.oss-cn-hangzhou.aliyuncs.com (you_bucket_name 是你的 bucket 的名称)</span>
  config.aliyun_host       <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>http://foo.bar.com<span class="pl-pds">"</span></span>
  <span class="pl-c"># 配置缩略图 Host，默认 #{aliyun_bucket}.img-#{aliyun_area}.aliyuncs.com</span>
  <span class="pl-c"># config.aliyun_img_host   = "http://you_bucket_name.img-cn-hangzhou.aliyuncs.com"</span>
  <span class="pl-c"># Bucket 为私有读取请设置 true，默认 false，以便得到的 URL 是能带有 private 空间访问权限的逻辑</span>
  <span class="pl-c"># config.aliyun_private_read = false</span>
<span class="pl-k">end</span></pre></div>

<h2>
<a id="阿里云-oss-图片缩略图" class="anchor" href="#%E9%98%BF%E9%87%8C%E4%BA%91-oss-%E5%9B%BE%E7%89%87%E7%BC%A9%E7%95%A5%E5%9B%BE" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>阿里云 OSS 图片缩略图</h2>

<p>从 <strong>0.5.0</strong> 版本开始，carrierwave-aliyun 支持 Aliyun OSS 的图片缩略图了，你只需要在 Uploader 对象的 <code>url</code> 函数后面跟上 <code>:thumb</code> 附带缩略图参数就可以了。</p>

<blockquote>
<p>NOTE: 此方法同样支持 Private 的 Bucket 哦！</p>
</blockquote>

<p>关于阿里云 OSS 图片缩略图的详细文档，请仔细阅读: <a href="https://help.aliyun.com/document_detail/32210.html">Aliyun OSS 接入图片服务</a></p>

<div class="highlight highlight-source-ruby"><pre>irb<span class="pl-k">&gt;</span> <span class="pl-c1">User</span>.last.avatar.url(<span class="pl-c1">thumb:</span> <span class="pl-s"><span class="pl-pds">'</span>@100w_1c<span class="pl-pds">'</span></span>)
<span class="pl-c1">https:</span><span class="pl-sr"><span class="pl-pds">//sim</span></span>ple.img<span class="pl-k">-</span>cn<span class="pl-k">-</span>hangzhou.aliyuncs.com<span class="pl-k">/</span>users<span class="pl-k">/</span>avatar<span class="pl-k">/</span><span class="pl-c1">12</span>.png@100w_1c
irb<span class="pl-k">&gt;</span> <span class="pl-c1">User</span>.last.avatar.url(<span class="pl-c1">thumb:</span> <span class="pl-s"><span class="pl-pds">'</span>@100w_200h_1c.jpg<span class="pl-pds">'</span></span>)
<span class="pl-c1">https:</span><span class="pl-sr"><span class="pl-pds">//sim</span></span>ple.img<span class="pl-k">-</span>cn<span class="pl-k">-</span>hangzhou.aliyuncs.com<span class="pl-k">/</span>users<span class="pl-k">/</span>avatar<span class="pl-k">/</span><span class="pl-c1">12</span>.png@100w_200h_1c.jpg
irb<span class="pl-k">&gt;</span> <span class="pl-c1">User</span>.last.avatar.url(<span class="pl-c1">thumb:</span> <span class="pl-s"><span class="pl-pds">'</span>@100w_200h_1c_95q<span class="pl-pds">'</span></span>)
<span class="pl-c1">https:</span><span class="pl-sr"><span class="pl-pds">//sim</span></span>ple.img<span class="pl-k">-</span>cn<span class="pl-k">-</span>hangzhou.aliyuncs.com<span class="pl-k">/</span>users<span class="pl-k">/</span>avatar<span class="pl-k">/</span><span class="pl-c1">12</span>.png@100w_200h_1c_95q
<span class="pl-c"># 你也可以用自定义的缩略图格式</span>
irb<span class="pl-k">&gt;</span> <span class="pl-c1">User</span>.last.avatar.url(<span class="pl-c1">thumb:</span> <span class="pl-s"><span class="pl-pds">'</span>@!large<span class="pl-pds">'</span></span>)</pre></div>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/huacnlee/carrierwave-aliyun">carrierwave-aliyun</a> is maintained by <a href="https://github.com/huacnlee">huacnlee</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

            <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-9745660-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>
